{% extends "admin/layout.html" %}                                                
{% block title %} Subscribers {% endblock %}                                
                                                                                 
{% block hero %}                                                                 
                                                                                 
<h1 class="title is-1 has-text-white has-text-centered is-size-3-mobile">
    My Subscribers
</h1>                                                                        
                                                                                 
{% endblock hero %} 
                                                                                 
{% block body %}

<div style="padding: 1rem 1.5rem 0 1.5rem;">                                     
  <div class="container">                                                        
    <nav class="breadcrumb" aria-label="breadcrumbs">                            
      <ul>                                                                       
        <li><a href="/">Shop</a></li>                                            
        <li><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>   
        <li class="is-active"><a href="#" aria-current="page">
            Subscribers</a>
        </li>                                                                    
      </ul>                                                                      
    </nav>                                                                       
  </div>                                                                         
</div>

<main>
  <div class="section">
    <div class="container">

      <table class="table is-hoverable is-fullwidth">
        <thead>
          <tr>
            <th>Date</th>
            <th>Name</th>
            <th>Contacts</th>
            <th>Address</th>
            <th>Subscription</th>
          </tr>
        </thead>
        <tbody>
        {% for person in people.items %}
          <tr>
            <td>{% if person.created_at %} 
              {{ person.created_at.strftime('%Y-%m-%d') }}
            {% endif %}</td>
            <td>{{ person.given_name }} {{ person.family_name }}</td>
            <td><strong>Email: </strong><a href="mailto:{{ person.email }}">{{ person.email }}</a><br>
                <strong>Phone: </strong><a href="tel:{{ person.phone }}">{{ person.phone }}</a><br></td>
            <td><address>
              {{ person.address_line1 }}<br />
              {{ person.city }} <br />
              {{ person.postal_code }} <br />
            </address></td>
            <td>
              {% if person.subscriptions %}
              <div class="content">
              <ul class="is-unstyled-li">
                {% for subscription in person.subscriptions %}
                <li><div class="card">
                  <ul class="is-unstyled-li">
                    <li><strong>Title: </strong>{{ jamla_get(sku_uuid=subscription.sku_uuid)['title'] }}</li>
                    <li><strong>ID: </strong>{{ subscription.uuid }}</li>
                    <li><strong>Date started: </strong>{{ subscription.created_at.strftime('%Y-%m-%d') }}</li>
                    <li><strong>GoCardless Subscription id: </strong>
                      {% if subscription.gocardless_subscription_id %}
                      <a href="https://manage.gocardless.com/subscriptions/{{ subscription.gocardless_subscription_id }}"
                        target="_blank" title="View subscription in GoCardless dashboard">
                        {{ subscription.gocardless_subscription_id }}</a>
                      {% else %}
                        None
                      {% endif %}</li>
                    <li><strong>Price monthly: </strong>{{ jamla_get(sku_uuid=subscription.sku_uuid)['monthly_price']|default(0)|currencyFormat }}</li>
                    <li><strong>Sell price: </strong>{{ jamla_get(sku_uuid=subscription.sku_uuid)['sell_price']|default(0)|currencyFormat }}</li>
                    <li><strong>Status: </strong>{{subscription_status(subscription.gocardless_subscription_id)}}</li>
                    <li><strong>Actions: </strong>
                      {% if subscription.gocardless_subscription_id %}
                      {% if subscription_status(subscription.gocardless_subscription_id) == 'Active' %}
                      <a href="{{ url_for("admin.pause_gocardless_subscription",
                        subscription_id=subscription.gocardless_subscription_id,
                        goback=1) }}">
                       Pause
                      </a> | 
                      {% endif %}
                      {% if subscription_status(subscription.gocardless_subscription_id) == 'Paused' %}
                      <a href="{{ url_for("admin.resume_gocardless_subscription",
                        subscription_id=subscription.gocardless_subscription_id,
                        goback=1) }}">
                       Resume
                      </a>
                      {% endif %}
                    {% endif %}</li>
                  </ul>
                </div></li>
                {% endfor %}
                {% else %}
                  None
              </ul></div>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <nav class="pagination" role="navigation" aria-label="pagination">
        {% if people.has_prev %}
          <a class="pagination-previous" href="{{ url_for('admin.subscribers', page=people.page - 1) }}">Previous</a>
        {% endif %}
        {% if people.has_next %}
          <a class="pagination-next" href="{{ url_for('admin.subscribers', page=people.page + 1) }}">Next page</a>
        {% endif %}
      <ul class="pagination-list">
      {% for page_num in people.iter_pages() %}
        <li>
        {% if page_num %}
          {% if people.page == page_num %}
            <a class="pagination-link is-current" href="{{ url_for('admin.subscribers', page=page_num) }}"><b>{{ page_num }}</b></a>
          {% else %}
            <a class="pagination-link" href="{{ url_for('admin.subscribers', page=page_num) }}">{{ page_num }}</a>
  
          {% endif %}
        {% else %}
          ...
        {% endif %}
        </li>
      {% endfor %}
      </ul>
      </nav>
    </div> <!-- end .container -->
  </div><!-- end .section -->
</main>

{% endblock body %} 
